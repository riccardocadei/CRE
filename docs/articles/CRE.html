<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>CRE • CRE</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><!-- docsearch --><script src="../docsearch.js"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.3/docsearch.min.css" integrity="sha256-QOSRU/ra9ActyXkIBbiIB144aDBdtvXBcNc3OTNuX/Q=" crossorigin="anonymous">
<link href="../docsearch.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin="anonymous"></script><meta property="og:title" content="CRE">
<meta property="og:description" content="CRE">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">CRE</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/CRE.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li class="divider">
    <li class="dropdown-header">Introduction</li>
    <li>
      <a href="../articles/article_i1.html">article_i1</a>
    </li>
    <li>
      <a href="../articles/article_i2.html">article_i2</a>
    </li>
    <li>
      <a href="../articles/article_i3.html">article_i3</a>
    </li>
    <li class="divider">
    <li class="dropdown-header">Collabration</li>
    <li>
      <a href="../articles/article_c1.html">article_c1</a>
    </li>
    <li>
      <a href="../articles/article_c2.html">article_c2</a>
    </li>
    <li>
      <a href="../articles/article_c3.html">article_c3</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/fasrc/CRE/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
<form class="navbar-form navbar-right hidden-xs hidden-sm" role="search">
        <div class="form-group">
          <input type="search" class="form-control" name="search-input" id="search-input" placeholder="Search..." aria-label="Search for..." autocomplete="off">
</div>
      </form>
      
    </div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="CRE_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>CRE</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/fasrc/CRE/blob/master/vignettes/CRE.Rmd"><code>vignettes/CRE.Rmd</code></a></small>
      <div class="hidden name"><code>CRE.Rmd</code></div>

    </div>

    
    
<div id="installation" class="section level1">
<h1 class="hasAnchor">
<a href="#installation" class="anchor"></a>Installation</h1>
<p>To install the CRE package properly, you first must install the <a href="https://github.com/JingyuHe/XBART">XBART</a> and <a href="https://github.com/socket778/XBCF">XBCF</a> packages:</p>
<div id="how-to-install-the-xbart-package-linux" class="section level3">
<h3 class="hasAnchor">
<a href="#how-to-install-the-xbart-package-linux" class="anchor"></a>How to install the <a href="https://github.com/JingyuHe/XBART">XBART</a> package (linux):</h3>
<p>In your terminal, install necessary packages via <a href="https://brew.sh/">homebrew</a>:</p>
<pre><code>~ $ brew install gfortran
~ $ brew install llvm boost libomp</code></pre>
<p>Find the path to LDFLAGS by running <code>brew info llvm</code> (see example): For compilers to find llvm you may need to set:</p>
<pre><code>~ $ export LDFLAGS="-L/usr/local/opt/llvm/lib"</code></pre>
<p>Run the following two commands and take note of their output:</p>
<pre><code>~ $ which clang
~ $ which clang++</code></pre>
<p>Run the following in your terminal under your user directory:</p>
<pre><code>~ $ mkdir ~/.R # if it doesn’t already exist
~ $ cd .R
.R $ touch Makevars
.R $ open -e Makevars</code></pre>
<p>Copy the following into the text editor, replacing <code>/path/to/_</code> with the paths found above:</p>
<pre><code>CC=/path/to/clang
CXX=/path/to/clang++
CXX11=/path/to/clang++
CXX14=/path/to/clang++
CXX17=/path/to/clang++
CXX1X=/path/to/clang++
LDFLAGS=path/to/LDFLAGS -o task -fopenmp</code></pre>
<p>Example Makevars file:</p>
<pre><code>CC=/usr/local/opt/llvm/bin/clang
CXX=/usr/local/opt/llvm/bin/clang++
CXX11=/usr/local/opt/llvm/bin/clang++ 
CXX14=/usr/local/opt/llvm/bin/clang++ 
CXX17=/usr/local/opt/llvm/bin/clang++ 
CXX1X=/usr/local/opt/llvm/bin/clang++ 
LDFLAGS=-L/usr/local/opt/llvm/lib -o task -fopenmp</code></pre>
<p>Then in R, run:</p>
<pre><code><a href="https://devtools.r-lib.org/">library("devtools")
devtools::install_github("JingyuHe/XBART")</a></code></pre>
</div>
<div id="how-to-install-the-xbcf-package" class="section level3">
<h3 class="hasAnchor">
<a href="#how-to-install-the-xbcf-package" class="anchor"></a>How to install the <a href="https://github.com/socket778/XBCF">XBCF</a> package:</h3>
<p>In R, run:</p>
<pre><code><a href="https://devtools.r-lib.org/">library(devtools)
install_github("socket778/XBCF")</a></code></pre>
</div>
<div id="install-the-cre-package-from-github" class="section level3">
<h3 class="hasAnchor">
<a href="#install-the-cre-package-from-github" class="anchor"></a>Install the CRE package from GitHub:</h3>
<p>In R, run:</p>
<pre><code><a href="https://devtools.r-lib.org/">library("devtools")
devtools::install_github("fasrc/CRE")
library(CRE)</a></code></pre>
</div>
</div>
<div id="usage" class="section level1">
<h1 class="hasAnchor">
<a href="#usage" class="anchor"></a>Usage</h1>
<div id="users-need-to-call-only-one-function-in-the-cre-package-to-conduct-subgroup-analysis-cre-" class="section level3">
<h3 class="hasAnchor">
<a href="#users-need-to-call-only-one-function-in-the-cre-package-to-conduct-subgroup-analysis-cre-" class="anchor"></a>Users need to call only one function in the CRE package to conduct subgroup analysis: <code>cre()</code>.</h3>
<p>The <code><a href="../reference/cre.html">cre()</a></code> inputs asked from the user are as follows:</p>
<ul>
<li>
<code>y</code> the observed response vector</li>
<li>
<code>z</code> the treatment vector</li>
<li>
<code>X</code> the features matrix</li>
<li>
<code>ratio_dis</code> the ratio of data for discovery subsample</li>
<li>
<code>ite_method_dis</code> the method to estimate the discovery sample ITE (1)</li>
<li>
<code>ite_method_inf</code> the method to estimate the inference sample ITE (1)</li>
<li>
<code>include_ps_dis</code> whether to include the propensity score estimate in the discovery ITE estimation (2)</li>
<li>
<code>include_ps_inf</code> whether to include the propensity score estimate in the inference ITE estimation (2)</li>
<li>
<code>ntrees</code> the number of decision trees</li>
<li>
<code>min_nodes</code> the minimum size of the trees’ terminal nodes</li>
<li>
<code>max_nodes</code> the maximum size of the trees’ terminal nodes</li>
<li>
<code>t</code> the common support used in generating the causal rules matrix</li>
<li>
<code>q</code> the selection threshold used in selecting the causal rules</li>
<li>
<code>rules_method</code> the method for selecting causal rules with binary outcomes, either “conservative”, “anticonservative”, or NA</li>
</ul>
<p><strong>(1)</strong> Options for the ITE estimation: Inverse Propensity Weighting (<code>ipw</code>), Stabilized Inverse Propensity Weighting (<code>sipw</code>), Outcome Regression (<code>or</code>), Bayesian Additive Regression Trees (<code>bart</code>), Accelerated Bayesian Additive Regression Trees (<code>xbart</code>), Bayesian Causal Forests (<code>bcf</code>), Accelerated Bayesian Causal Forests (<code>xbcf</code>), or Causal Forests (<code>cf</code>)</p>
<p><strong>(2)</strong> This argument will only be considered if the ITE method selected is <code>bart</code>, <code>xbart</code>, or <code>cf</code></p>
</div>
<div id="cre-example" class="section level3">
<h3 class="hasAnchor">
<a href="#cre-example" class="anchor"></a>CRE Example:</h3>
<pre><code><a href="https://github.com/fasrc/CRE">library(CRE)
cre_results &lt;- cre(y, z, X, ratio_dis = 0.25, ite_method_dis = 'xbart', 
                   ite_method_inf = 'xbcf', include_ps_dis = TRUE, include_ps_inf = TRUE, 
                   ntrees = 100, min_nodes = 20, max_nodes = 5, t = 0.025, q = 0.8, rules_method = NA)
cre_select_rules &lt;- cre_results[[1]] # expected output: vector of rule strings
cre_cate_estimates_means &lt;- cre_results[[2]] # expected output: matrix of CATE estimates
cre_cate_estimates_regression &lt;- cre_results[[3]] # expected output: matrix of CATE estimates</a></code></pre>
</div>
</div>
<div id="testing-the-package-examples-and-discussion" class="section level1">
<h1 class="hasAnchor">
<a href="#testing-the-package-examples-and-discussion" class="anchor"></a>Testing the Package, Examples, and Discussion</h1>
<div id="running-examples" class="section level3">
<h3 class="hasAnchor">
<a href="#running-examples" class="anchor"></a>Running Examples</h3>
<p>You can use any causal inference studies data to test the package. The database needs to have the following attributes:</p>
<ul>
<li>
<code>y</code>: Output vector</li>
<li>
<code>z</code>: Treatment vector</li>
<li>
<code>X</code>: Covariate matrix</li>
</ul>
<p>The CRE package can generate synthetic data that can be used to test different features of the package. At the current implementation, the code can generate data with continuous or binary outcomes. In the following, we present some reproducible examples that you can copy and build upon.</p>
</div>
<div id="generating-synthetic-data-with-continuous-outcomes" class="section level3">
<h3 class="hasAnchor">
<a href="#generating-synthetic-data-with-continuous-outcomes" class="anchor"></a>Generating Synthetic Data with Continuous Outcomes</h3>
<pre><code><a href="https://github.com/fasrc/CRE">library("CRE")
dataset_cont &lt;- generate_cre_dataset(n = 1000, rho = 0, n_rules = 2, 
                                     effect_size = 0.5, binary = FALSE, seed = 2021) 
str(dataset_cont)
## List of 3
# $ y: num [1:1000] 2.72 2.79 3.2 2.53 2.49 ...
# $ z: int [1:1000] 0 0 1 1 1 1 0 1 0 0 ...
# $ X: num [1:1000, 1:10] 1 1 1 0 0 0 0 1 1 0 ...
#  ..- attr(*, "dimnames")=List of 2
#  .. ..$ : NULL
#  .. ..$ : chr [1:10] "X1" "X2" "X3" "X4" ...</a></code></pre>
</div>
<div id="generating-synthetic-data-with-binary-outcomes" class="section level3">
<h3 class="hasAnchor">
<a href="#generating-synthetic-data-with-binary-outcomes" class="anchor"></a>Generating Synthetic Data with Binary Outcomes</h3>
<pre><code><a href="https://github.com/fasrc/CRE">library("CRE")
dataset_binary &lt;- generate_cre_dataset(n = 1000, rho = 0, n_rules = 2, 
                                       effect_size = 0.5, binary = TRUE, seed = 2021) 
str(dataset_binary)
## List of 3
# $ y: num [1:1000] 1 0.5 0 0 1.5 1 1 1 -0.5 0 ...
# $ z: int [1:1000] 0 1 0 0 1 0 0 0 1 0 ...
# $ X: num [1:1000, 1:10] 1 1 1 0 0 0 0 1 1 0 ...
#  ..- attr(*, "dimnames")=List of 2
#  .. ..$ : NULL
#  .. ..$ : chr [1:10] "X1" "X2" "X3" "X4" ...</a></code></pre>
</div>
<div id="running-the-cre-on-synthetic-data-with-continuous-outcomes" class="section level3">
<h3 class="hasAnchor">
<a href="#running-the-cre-on-synthetic-data-with-continuous-outcomes" class="anchor"></a>Running the CRE on Synthetic Data with Continuous Outcomes</h3>
<p>In the following example, we first generate 1000 synthetic data samples, then we feed them into the <code><a href="../reference/cre.html">cre()</a></code> function to generate select causal rules and CATE estimates. You can read more about different arguments in the documentation (<code><a href="../reference/cre.html">?cre</a></code>). In summary:</p>
<ul>
<li>We want to run a code delegating 25% of the data for the discovery subsample and 75% for inference (<code>ratio_dis &lt;- 0.25</code>)</li>
<li>For the discovery subsample, we want to estimate the Individual Treatment effect using the XBART method, including the estimated propensity score as a covariate (<code>ite_method_dis &lt;- "xbart"</code> and <code>include_ps_dis &lt;- TRUE</code>)</li>
<li>For the inference subsample, we want to estimate the Individual Treatment effect using the XBCF method, which automatically includes the estimated propensity score as a covariate (<code>ite_method_inf &lt;- "xbcf"</code> and <code>include_ps_inf &lt;- NA</code>)</li>
<li>For the causal rule generation, we want to generate 100 decision trees with a minimum node size of 20 and a maximum node size of 5 (<code>ntrees &lt;- 100</code>, <code>min_nodes &lt;- 20</code>, and <code>max_nodes &lt;- 5</code>)</li>
<li>For trimming the causal rules, we want to use a common support value of 0.025 (<code>t &lt;- 0.025</code>)</li>
<li>For selecting the most important causal rules, we want to use a selection threshold of 0.8 (<code>q &lt;- 0.08</code>)</li>
<li>Since we’re not using binary outcomes in the first example, we will not specify a rules method (<code>rules_method &lt;- NA</code>)</li>
</ul>
<pre><code><a href="https://github.com/fasrc/CRE"># Load package
library("CRE")

# Generate synthetic data with continuous outcomes
dataset &lt;- generate_cre_dataset(n = 1000, rho = 0, n_rules = 2, 
                                effect_size = 0.5, binary = FALSE, seed = 2021) 

# Set parameters
y &lt;- dataset[["y"]]
z &lt;- dataset[["z"]]
X &lt;- dataset[["X"]]
ratio_dis &lt;- 0.25
ite_method_dis &lt;- "xbart"
ite_method_inf &lt;- "xbcf"
include_ps_dis &lt;- "TRUE"
include_ps_inf &lt;- NA
ntrees &lt;- 100
min_nodes &lt;- 20
max_nodes &lt;- 5
t &lt;- 0.025
q &lt;- 0.8
rules_method &lt;- NA

# Run CRE method
cre_results &lt;- cre(y, z, X, ratio_dis, ite_method_dis, ite_method_inf, 
                   include_ps_dis, include_ps_inf, ntrees, min_nodes, max_nodes, 
                   t, q, rules_method)</a></code></pre>
</div>
<div id="running-the-cre-on-synthetic-data-with-binary-outcomes" class="section level3">
<h3 class="hasAnchor">
<a href="#running-the-cre-on-synthetic-data-with-binary-outcomes" class="anchor"></a>Running the CRE on Synthetic Data with Binary Outcomes</h3>
<p>To run the CRE method on synthetic data with binary outcomes, set the <code>binary</code> argument in <code>generate_cre_dataset</code> to TRUE, and specify the <code>rules_method</code> parameter. Note: The following ITE estimation methods are <strong>NOT</strong> compatible with binary outcomes: <code>ipw</code>, <code>sipw</code>, <code>bcf</code>, <code>xbcf</code></p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Kwonsang Lee, Falco Joannes Bargagli Stoffi, Daniela Maria Garcia, Naeem Khoshnevis.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  
<script src="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.1/docsearch.min.js" integrity="sha256-GKvGqXDznoRYHCwKXGnuchvKSwmx9SRMrZOTh2g4Sb0=" crossorigin="anonymous"></script><script>
  docsearch({
    
    
    apiKey: 'API_KEY',
    indexName: 'INDEX_NAME',
    inputSelector: 'input#search-input.form-control',
    transformData: function(hits) {
      return hits.map(function (hit) {
        hit.url = updateHitURL(hit);
        return hit;
      });
    }
  });
</script>
</body>
</html>
